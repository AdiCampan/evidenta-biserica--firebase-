#!/bin/bash

# Hook pre-push para automatizar el build y deploy
echo "ğŸ” Ejecutando hook pre-push para build y deploy automÃ¡tico..."

# Verificar si hay cambios sin commit
if [[ $(git status --porcelain) ]]; then
  echo "âŒ Error: Hay cambios sin commit. Por favor, haz commit de todos los cambios antes de hacer push."
  exit 1
fi

# Ejecutar verificaciÃ³n de variables de entorno
echo "ğŸ” Verificando variables de entorno..."
node "$(git rev-parse --show-toplevel)/deploy-check.js"

# Si la verificaciÃ³n falla, el script se detendrÃ¡ aquÃ­ debido al cÃ³digo de salida

# Ejecutar build
echo "ğŸ—ï¸ Ejecutando build..."
npm run build

# Si el build es exitoso, ejecutar deploy
if [ $? -eq 0 ]; then
  echo "ğŸš€ Ejecutando deploy..."
  firebase deploy
  
  if [ $? -eq 0 ]; then
    echo "âœ… Deploy completado con Ã©xito."
  else
    echo "âŒ Error durante el deploy."
    exit 1
  fi
else
  echo "âŒ Error durante el build."
  exit 1
fi

# Continuar con el push si todo fue exitoso
exit 0